\section{Customizing the application}
\subsection{connection of the DMA FIFOs}
Wupper comes with an example application that is described in \ref{sec:ExampleApp}. The toplevel file for the user application is application.vhd

If you want to customize the example application for your own needs, the application can be stripped down to only containing the two FIFO cores. The application can be controlled and monitored by the records "registermap\_control" and "registermap\_monitor". These records contain all the read/write register and the read only registers respectively, the registers are defined in the file pcie\_package.vhd.

This file contains a read and a write port for a FIFO. This FIFO has a port width of 256 bit and is read or written at 250 MHz, resulting in a theoretical throughput of 60Gbit/s.

\subsection{Application specific registers}
Besides DMA memory reads and writes, the PCIe Engine also provides means to create a custom application specific register map. By default, the BAR2 register space is reserved for this purpose.

\begin{lstlisting}[language=VHDL, frame=single, caption=custom register types]
  type register_map_control_type is record
    BOARD_ID         : std_logic_vector(63 downto 0);    
    STATUS_LEDS      : std_logic_vector(7 downto 0);
  end record;
  
  type register_map_monitor_type is record
    READ_ONLY             : std_logic_vector(0 downto 0);    
    PLL_LOCK              : std_logic_vector(0 downto 0);    
  end record;
\end{lstlisting}

When adding registers to this map, there are two files (besides the application implementation) that need to be modified:
\begin{itemize}
 \item{pcie\_package.vhd} containing the address, the default value and the record type specification
 \item{dma\_control.vhd} containing the constant initialization, the read state machine and the write state machine
\end{itemize}

sections that should be modified can be recognized by searching for comments like this:
\begin{lstlisting}[language=VHDL, frame=single, caption=customizable sections]
  ------------------------------------------------
  ---- Application specific registers BEGIN   ----
  ------------------------------------------------
  ...
  ------------------------------------------------
  ---- Application specific registers END     ----
  ------------------------------------------------
\end{lstlisting}


\newpage