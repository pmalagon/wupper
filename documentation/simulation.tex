\section{Simulation}
The directory \textit{firmware/simulation/pcie\_dma\_top} contains all necessary files to run the simulation in Mentor Graphics Modelsim or Questasim \cite{questasim}. 

\subsection{Prerequisites}
The directory contains a file modelsim.ini with some standard information, it is assumed that one have the Xilinx Unisim\_VCOMPONENTS library compiled and the location is defined in the environment variable \$XILLIB. Also the Library "work" has to be created in the project directory.

The simulation project also relies on a simulation model of the FIFOcore, which will be generated when the cores in the Vivado project are generated. The file that should be generated is \textit{../../Projects/pcie\_dma\_top/pcie\_dma\_top.srcs/sources\_1/ip/fifo\_generator\_0 /fifo\_generator\_0\_funcsim.vhdl}

\subsection{Creating the project and running the simulation.}
Like the Vivado project, also the Questasim project is generated and operated using .tcl scripts. To create and run the project execute the following commands from the Questasim console:
\begin{lstlisting}[language=tcl, frame=single, caption=Run the simulation]
cd firmware/simulation/pcie_dma_top/
#Create the project:
do project.do
#Start the simulation and load the waveforms:
do VSim_Functional.tcl
#Add stimuli to the AXI bus
do start.do
run 1us
\end{lstlisting}
The project does also include the actual PCIe core simulation model, but the AXI4-Stream interface altered by stimuli in start.do, it can be edited according to your needs.
\newpage